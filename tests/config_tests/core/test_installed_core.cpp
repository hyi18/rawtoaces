// Copyright Contributors to the rawtoaces project.
// SPDX-License-Identifier: Apache-2.0
// https://github.com/AcademySoftwareFoundation/rawtoaces

#ifdef WIN32
#    define WIN32_LEAN_AND_MEAN
#    include <windows.h>
#endif

#include <OpenImageIO/unittest.h>
#include <rawtoaces/rawtoaces_core.h>

void testIllum_calDayLightSPD()
{
    rta::core::Spectrum illuminant;
    rta::core::calculate_daylight_SPD( 50, illuminant );

    const double spd[81] = {
        24.4978949755877,  27.1891380970612,  29.8803812185346,
        39.6005856124086,  49.3207900062826,  52.9234909452740,
        56.5261918842655,  58.2863692933629,  60.0465467024602,
        58.9374754654423,  57.8284042284244,  66.3321986672105,
        74.8359931059968,  81.0470608788071,  87.2581286516173,
        88.9401444234118,  90.6221601952063,  90.9994142932283,
        91.3766683912501,  93.2463519723246,  95.1160355533991,
        93.5424463111289,  91.9688570688586,  93.8487650824512,
        95.7286730960438,  96.1730210585583,  96.6173690210728,
        96.8745483082553,  97.1317275954378,  99.6163972828030,
        102.1010669701683, 101.4285401947830, 100.7560134193976,
        101.5368117967032, 102.3176101740087, 101.1588050870044,
        100.0000000000000, 98.8672487920966,  97.7344975841932,
        98.3256924971888,  98.9168874101845,  96.2071139031367,
        93.4973403960889,  95.5913911756801,  97.6854419552712,
        98.4757935279747,  99.2661451006782,  99.1520792059532,
        99.0380133112281,  97.3779908297348,  95.7179683482415,
        97.2852940116115,  98.8526196749816,  97.2575832997790,
        95.6625469245764,  96.9235194654881,  98.1844920063998,
        100.5908749767109, 102.9972579470220, 101.0620719501407,
        99.1268859532593,  93.2512715124010,  87.3756570715427,
        89.4866296124544,  91.5976021533661,  92.2403288193421,
        92.8830554853180,  84.8664480824888,  76.8498406796596,
        81.6780321648151,  86.5062236499707,  89.5403942033879,
        92.5745647568050,  85.4000426306844,  78.2255205045638,
        67.9569774467047,  57.6884343888457,  70.3033080876698,
        82.9181817864939,  80.5938616113981,  78.2695414363022
    };

    std::vector<double> &data = illuminant.values;
    for ( size_t i = 0; i < data.size(); i++ )
        OIIO_CHECK_EQUAL_THRESH( data[i], spd[i], 1e-5 );
};

int main( int, char ** )
{
    testIllum_calDayLightSPD();

    return unit_test_failures;
};
